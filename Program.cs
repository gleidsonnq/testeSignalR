using System;
using System.Threading.Tasks;
using System.Device.Gpio;
using Microsoft.AspNetCore.SignalR.Client;


namespace Controle{
    class Program{
        static async Task Main(string[] args){
            string token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJodHRwczovL2FwaS1oLTIuaW50cmFuZXQubWFyYWNhbmF1LmlmY2UuZWR1LmJyIiwiaWF0IjoxNjc4NzA2OTM3LCJleHAiOjE2Nzg3Mjg1MzcsIm5iZiI6MTY3ODcwNjkzNywianRpIjoiYTRNTUpLTFJWS1pQbndDVCIsInN1YiI6IjE3MiIsInBydiI6IjMyMWM0OGMwMTdhZWFjMTA2MTI0OTlmMjg2YTgxNjJkNjRhN2Q3ZjgiLCJhdWQiOiJodHRwczovL2FwaS5pbnRyYW5ldC1oLm1hcmFjYW5hdS5pZmNlLmVkdS5iciIsImlkIjoxNzIsIm5vbWUiOiJHQUJSSUVMIENMRUlUT04gQ0FWQUxDQU5URSBOVU5FUyIsIm5vbWVfc29jaWFsIjpudWxsLCJlbWFpbCI6ImdhYnJpZWwuY2xlaXRvbi5jYXZhbGNhbnRlMDdAYWx1bm8uaWZjZS5lZHUuYnIiLCJlbWFpbF9pbnN0aXR1Y2lvbmFsIjoiZ2FicmllbC5jbGVpdG9uLmNhdmFsY2FudGUwN0BhbHVuby5pZmNlLmVkdS5iciIsImlkZW50aWZpY2FjYW8iOjIwMTkxMDQ1MDUwMTcwLCJpZGVudGlmaWNhY2FvX2lkIjozNjUwLCJwZXNzb2FfdGlwbyI6IkFsdW5vIGRhIEdyYWR1YcOnw6NvIiwicGVzc29hX3RpcG9faWQiOjEsImFjZWl0ZV90ZXJtb3NfdXNvIjoxLCJkYXRhX2FjZWl0ZV90ZXJtb3NfdXNvIjoiMjAyMi0wMy0wNyAxOTo0NTo0MSIsImNvbXByb3ZhbnRlX2NvdmlkMTkiOjEsInVybF9jb21wcm92YW50ZV9jb3ZpZDE5Ijoic29saWNpdGFjb2VzL2NvbXByb3ZhbnRlX2NvdmlkMTkvQ3JDTkNzQndicHM5RHdpOTE2NnlDM0FDa1RMU0ViOTExYWFTYXdrTC5wZGYiLCJpZGVudGlmaWNhY29lcyI6WzIwMTkxMDQ1MDUwMTcwXSwicGVybWlzc29lcyI6W3sibm9tZSI6IkFQSV9ibG9jb3MiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vYmxvY29zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9jYXJnb3MiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vY2FyZ29zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9jYXRlZ29yaWFzIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9jaGF2ZXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2NoYXZlcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfY29tcHJvdmFudGVzX2NvdmlkMTkiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL3ZhY2luYS9lbnZpby1jb21wcm92YW50ZSIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfZ2VyZW5jaWFyX2NvbXByb3ZhbnRlc19jb3ZpZDE5IiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii92YWNpbmEvdmFsaWRhY2FvIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii92YWNpbmEvbmFvLWVudmlhZG9zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9jb25maWd1cmFjYW9fYW5pdmVyc2FyaWFudGUiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FuaXZlcnNhcmlhbnRlL2NvbmZpZ3VyYWNhbyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfZW52aWFyX2ltYWdlbnNfYW5pdmVyc2FyaWFudGUiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FuaXZlcnNhcmlhbnRlL2Vudmlhci1pbWFnZW5zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9jdXJzb3MiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vY3Vyc29zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9laXhvcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiIvYWRtaW5pc3RyYWNhby9laXhvcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfZW1wcmVzYXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vZW1wcmVzYXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX2ZlcmlhZG9fdGlwb3MiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX2ZlcmlhZG9zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9hZG1pbmlzdHJhY2FvL2ZlcmlhZG9zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9mdW5jb2VzIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9hZG1pbmlzdHJhY2FvL2Z1bmNvZXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX2dydXBvc19hY2Vzc28iLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vZ3J1cG9zLWFjZXNzbyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfbGlua3NfcmFwaWRvcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiIvYWRtaW5pc3RyYWNhby9saW5rcy1yYXBpZG9zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9sb2NhaXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vbG9jYWlzIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9sb3RhY29lcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiIvYWRtaW5pc3RyYWNhby9sb3RhY29lcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfcGVybWlzc2FvX2NhdGVnb3JpYXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX3Blcm1pc3NvZXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vcGVybWlzc29lcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfYWNlaXRlX3Rlcm1vcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfcGVzc29hc19pZGVudGlmaWNhY29lcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfcGVzc29hcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiIvYWRtaW5pc3RyYWNhby9wZXNzb2FzIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9wZXNzb2FfdGlwb3MiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX3NldG9yZXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vc2V0b3JlcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfc2l0dWFjb2VzIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV90aXBvc19sb2NhaXMiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiL2FkbWluaXN0cmFjYW8vdGlwb3MtbG9jYWwiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiYWNlaXRlLXRlcm1vcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfZGFzaGJvYXJkIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9hanVkYS9lbWFpbC1hY2FkZW1pY28iLCJ0aXBvIjoiUldEIn0seyJub21lIjoiLyIsInRpcG8iOiJSIn0seyJub21lIjoiQVBJX2N1cnNvX3RpcG9zIiwidGlwbyI6IlIifSx7Im5vbWUiOiJBUElfcmVzdGF1cmFudGVfY29uZmlndXJhY2FvIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9yZXN0YXVyYW50ZV9wcmVwYXJhY29lcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfcmVzdGF1cmFudGVfcHJlcGFyYWNhb190aXBvcyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiJBUElfcmVzdGF1cmFudGVfdHJhbnNpdG9fbGFuY2hlIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6IkFQSV9yZXN0YXVyYW50ZV9jYXJkYXBpbyIsInRpcG8iOiJSV0QifSx7Im5vbWUiOiIvcmVzdGF1cmFudGUvdHJhbnNpdG8tbGFuY2hlIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9yZWNlcGNhby90cmFuc2l0by1jYXRyYWNhIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9wZ3EiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX2NvbXByb3ZhbnRlc19jb3ZpZDE5IiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii92YWNpbmEvZW52aW8tY29tcHJvdmFudGUiLCJ0aXBvIjoiUldEIn0seyJub21lIjoiQVBJX2xpbmtzX3JhcGlkb3MiLCJ0aXBvIjoiUiJ9LHsibm9tZSI6IkFQSV9hY2VpdGVfdGVybW9zIiwidGlwbyI6IlJXRCJ9LHsibm9tZSI6Ii9hanVkYS9lbWFpbC1hY2FkZW1pY28iLCJ0aXBvIjoiUldEIn0seyJub21lIjoiLyIsInRpcG8iOiJSIn0seyJub21lIjoiL3BncSIsInRpcG8iOiJXIn1dfQ.Qqzg8bnkGFnwGPtVS6CcWV0HyM8wbYR2Nq15JXpXsvQvz-1yBlC37-hhpY200Y5Ajv6uqeWajWrAMrJBUMn4-g";
            string url = "wss://api.intranet-h.maracanau.ifce.edu.br/hubs/transito-catraca";
            Console.WriteLine("Inicio");
            var connection = new HubConnectionBuilder()
                    .WithUrl(url, options => {
                        options.AccessTokenProvider = () => Task.FromResult(token);
                    })
                    .WithAutomaticReconnect()
                    .Build();
            while (true)
            {
                try{
                    await connection.StartAsync();
                    connection.On<string>("ReceiveMessage", (message) => {
                        Console.WriteLine(message);
                    });
                }catch (TimeoutException){
                    Console.WriteLine("erro");
                }
            }   
        }
    }
}